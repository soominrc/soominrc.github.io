<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Access Under Conditions</title>
  <meta name="description" content="A non-linear archive about access, redaction, and what systems choose to show." />
  <meta property="og:title" content="Access Under Conditions" />
  <meta property="og:description" content="A non-linear archive about access, redaction, and what systems choose to show." />
  <meta property="og:type" content="website" />

  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='64' height='64'%3E%3Crect width='64' height='64' fill='%230b0b0b'/%3E%3Crect x='10' y='18' width='44' height='10' fill='%23ffffff' opacity='.9'/%3E%3Crect x='10' y='34' width='30' height='10' fill='%23ffffff' opacity='.7'/%3E%3C/svg%3E" />

  <style>
    :root{
      --bg:#0b0b0b;
      --ink:#f2f2f2;
      --muted:rgba(242,242,242,.62);
      --line:rgba(242,242,242,.18);
      --window:#101010;
      --shadow:0 30px 80px rgba(0,0,0,.55);

      --paper:#ffffff;
      --txt:rgba(0,0,0,.90);
      --hair:rgba(0,0,0,.10);

      --folder:#e9e9e9;
      --folder2:#d7d7d7;
      --folder-stroke:rgba(0,0,0,.20);

      /* redaction ink */
      --blk:#0b0b0b;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      background:var(--bg);
      color:var(--ink);
      font-family:"Helvetica Neue", Helvetica, Arial, sans-serif;
      letter-spacing:-0.01em;
      overflow:auto;
    }

    /* ── Stage ─────────────────────────────────────── */
    .stage{
      min-height:100%;
      display:grid;
      grid-template-rows:auto 1fr;
      padding:26px clamp(18px,3vw,44px);
      gap:18px;
    }
    .topline{
      display:flex; justify-content:center; align-items:center; padding-top:6px;
    }
    .topline .title{
      font-size:12px; letter-spacing:.18em;
      text-transform:uppercase; opacity:.9; user-select:none;
    }
    .center{ display:grid; place-items:center; padding:10px 0; }

    /* ── Window ────────────────────────────────────── */
    .window{
      width:min(1020px,100%);
      border:1px solid var(--line);
      border-radius:16px; /* strict, not cartoon */
      background:var(--window);
      box-shadow:var(--shadow);
      overflow:hidden;
      display:grid;
      grid-template-rows:auto minmax(0,1fr);
    }

    /* ── Chrome ────────────────────────────────────── */
    .chrome{
      display:flex; align-items:center;
      justify-content:space-between; gap:16px;
      padding:14px 16px;
      border-bottom:1px solid rgba(242,242,242,.12);
      background:rgba(255,255,255,.02);
      user-select:none;
    }
    .dots{ display:flex; gap:8px; align-items:center; }
    .dotbtn{
      width:10px; height:10px; border-radius:50%;
      border:1px solid rgba(242,242,242,.22);
      background:rgba(242,242,242,.06);
      padding:0; cursor:pointer; display:inline-block;
    }
    .dotbtn:focus-visible{ outline:2px solid rgba(255,255,255,.6); outline-offset:3px; }
    .dotbtn.red    { background:rgba(255,95,86,.85);  border-color:rgba(255,95,86,.25); }
    .dotbtn.yellow { background:rgba(255,189,46,.85); border-color:rgba(255,189,46,.25); }
    .dotbtn.green  { background:rgba(39,201,63,.85);  border-color:rgba(39,201,63,.25); }

    .url{
      flex:1; text-align:center; font-size:12px;
      color:var(--muted); letter-spacing:.10em; text-transform:uppercase;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .chromeRight{
      display:flex; align-items:center; gap:10px;
      min-width:92px; justify-content:flex-end;
    }
    .iconBtn{
      width:28px; height:28px;
      display:grid; place-items:center;
      border:1px solid rgba(242,242,242,.18);
      background:transparent; color:rgba(242,242,242,.75);
      cursor:pointer;
      border-radius:6px;
      font-size:13px;
    }
    .iconBtn:hover{ background:rgba(242,242,242,.06); }
    .iconBtn:focus-visible{ outline:2px solid rgba(255,255,255,.55); outline-offset:3px; }

    /* ── Content area ──────────────────────────────── */
    .content{
      min-height:0; overflow:auto;
      scrollbar-gutter:stable;
      -webkit-overflow-scrolling:touch;
      background:var(--window);
    }

    /* window states */
    .window.is-minimized .content{ display:none; }
    .window.is-fullscreen{
      position:fixed; inset:14px;
      width:auto; height:auto;
      z-index:999; border-radius:12px;
    }

    /* ── Page switching (hash-based) ───────────────── */
    #record, #about { display:none; }
    #record:target{ display:block; }
    #about:target{ display:block; }

    .content:has(#record:target) #landing{ display:none; }
    .content:has(#record:target) #record{ display:block; }

    .content:has(#about:target) #landing{ display:none; }
    .content:has(#about:target) #about{ display:block; }

    /* ════════════════════════════════════════════════
       LANDING (files on the side, no big text body)
    ════════════════════════════════════════════════ */
    .landingWrap{
      padding:22px;
      display:grid;
      grid-template-columns:1.08fr .92fr;
      gap:18px;
      align-items:stretch;
    }
    .landingLeft{
      border:1px solid rgba(242,242,242,.10);
      border-radius:12px;
      background:rgba(255,255,255,.02);
      padding:18px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      min-height:420px;
    }
    .landingMark{
      font-size:12px;
      letter-spacing:.18em;
      text-transform:uppercase;
      color:rgba(242,242,242,.70);
      line-height:1.4;
    }
    .landingHint{
      font-size:12px;
      letter-spacing:.10em;
      text-transform:uppercase;
      color:rgba(242,242,242,.42);
      line-height:1.5;
    }

    .photo{
      border:1px solid rgba(242,242,242,.10);
      border-radius:12px;
      overflow:hidden;
      background:rgba(255,255,255,.02);
      min-height:420px;
      display:grid;
      grid-template-rows:auto 1fr auto;
    }
    .photoTop{
      padding:12px 12px 10px;
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      border-bottom:1px solid rgba(242,242,242,.10);
      background:rgba(255,255,255,.02);
    }
    .photoTop .label{
      font-size:11px; letter-spacing:.14em; text-transform:uppercase;
      color:rgba(242,242,242,.65); user-select:none; white-space:nowrap;
    }
    .photoTop .hint{
      font-size:11px; letter-spacing:.12em; text-transform:uppercase;
      color:rgba(242,242,242,.42); user-select:none; white-space:nowrap;
    }
    .fileField{
      position:relative;
      background:
        radial-gradient(420px 340px at 50% 42%, rgba(255,255,255,.06), rgba(255,255,255,0) 70%),
        linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,0));
      overflow:hidden;
    }
    .files{
      position:absolute; inset:0; padding:10px;
      display:grid;
      grid-template-columns:repeat(10, minmax(0,1fr));
      grid-auto-rows:26px;
      pointer-events:auto;
    }
    .file{
      pointer-events:auto; width:40px; height:32px;
      position:relative; cursor:pointer;
      justify-self:center; align-self:center;
      filter:drop-shadow(0 10px 18px rgba(0,0,0,.32));
      transition:transform .12s ease, filter .12s ease, opacity .22s ease;
      text-decoration:none; outline:none;
    }
    .file:hover{
      filter:drop-shadow(0 14px 26px rgba(0,0,0,.42)) brightness(1.05);
      transform:translateY(-1px);
    }
    .file:active{ transform:translateY(0) scale(.99); }
    .file:focus-visible{ outline:2px solid rgba(255,255,255,.65); outline-offset:3px; }
    .file::before{
      content:""; position:absolute;
      left:0; right:0; top:7px; bottom:0;
      border-radius:8px;
      background:linear-gradient(180deg, var(--folder), var(--folder2));
      border:1px solid var(--folder-stroke);
      box-shadow:inset 0 1px 0 rgba(255,255,255,.55), 0 1px 0 rgba(0,0,0,.10);
    }
    .file::after{
      content:""; position:absolute;
      left:5px; top:2px; width:18px; height:10px;
      border-radius:7px 7px 5px 5px;
      background:linear-gradient(180deg, rgba(255,255,255,.78), rgba(255,255,255,.42));
      border:1px solid rgba(0,0,0,.12);
      box-shadow:inset 0 1px 0 rgba(255,255,255,.55);
    }
    .photoBottom{
      padding:12px;
      border-top:1px solid rgba(242,242,242,.10);
      background:rgba(255,255,255,.02);
      font-size:11px;
      letter-spacing:.12em;
      text-transform:uppercase;
      color:rgba(242,242,242,.45);
      user-select:none;
      display:flex;
      justify-content:space-between;
      gap:12px;
    }

    /* ════════════════════════════════════════════════
       ABOUT PAGE (separate icon page)
    ════════════════════════════════════════════════ */
    .aboutWrap{
      padding:22px;
      display:grid;
      grid-template-columns:1fr;
      gap:14px;
    }
    .aboutCard{
      border:1px solid rgba(242,242,242,.12);
      border-radius:12px;
      background:rgba(255,255,255,.02);
      padding:18px;
      max-width:860px;
    }
    .aboutTitle{
      margin:0 0 10px;
      font-size:12px;
      letter-spacing:.18em;
      text-transform:uppercase;
      color:rgba(242,242,242,.80);
    }
    .aboutText{
      margin:0;
      font-size:14px;
      line-height:1.7;
      color:rgba(242,242,242,.70);
      max-width:72ch;
    }
    .aboutRule{
      margin-top:14px;
      padding-top:14px;
      border-top:1px solid rgba(242,242,242,.10);
      font-size:12px;
      letter-spacing:.12em;
      text-transform:uppercase;
      color:rgba(242,242,242,.45);
      line-height:1.6;
    }
    .aboutLinks{
      margin-top:14px;
      display:flex;
      flex-wrap:wrap;
      gap:10px;
    }
    .aboutLink{
      font-size:12px;
      letter-spacing:.10em;
      text-transform:uppercase;
      color:rgba(242,242,242,.75);
      text-decoration:none;
      border-bottom:1px solid rgba(242,242,242,.25);
      padding-bottom:2px;
    }
    .aboutLink:hover{ color:#fff; border-bottom-color:rgba(255,255,255,.55); }

    /* ════════════════════════════════════════════════
       RECORD PAGE (bureaucratic friction, no click-to-reveal)
    ════════════════════════════════════════════════ */
    .recordWrap{
      padding:22px;
    }
    .topBar{
      width:min(980px,100%);
      margin:0 auto 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }
    .navBtn{
      border:1px solid rgba(242,242,242,.18);
      background:transparent;
      color:rgba(242,242,242,.80);
      padding:9px 12px;
      border-radius:10px;
      font-size:12px;
      letter-spacing:.10em;
      text-transform:uppercase;
      cursor:pointer;
      user-select:none;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      flex-shrink:0;
    }
    .navBtn:hover{ background:rgba(242,242,242,.06); }

    .requestPanel{
      display:flex;
      align-items:center;
      justify-content:flex-end;
      gap:10px;
      flex:1;
      min-width:280px;
    }
    .miniLabel{
      font-size:10px;
      letter-spacing:.18em;
      text-transform:uppercase;
      color:rgba(242,242,242,.40);
      white-space:nowrap;
      user-select:none;
    }
    .select, .input{
      font-family:"Helvetica Neue", Helvetica, Arial, sans-serif;
      border:1px solid rgba(242,242,242,.14);
      background:rgba(255,255,255,.02);
      color:rgba(242,242,242,.82);
      border-radius:10px;
      padding:9px 10px;
      font-size:12px;
      letter-spacing:.06em;
      outline:none;
    }
    .select{ cursor:pointer; }
    .select:focus-visible, .input:focus-visible{ outline:2px solid rgba(255,255,255,.40); outline-offset:2px; }
    .input{ width:190px; }
    .checkWrap{
      display:flex; align-items:center; gap:8px;
      border:1px solid rgba(242,242,242,.14);
      background:rgba(255,255,255,.02);
      padding:8px 10px;
      border-radius:10px;
    }
    .checkWrap input{ accent-color:#ffffff; }
    .checkWrap span{
      font-size:10px;
      letter-spacing:.16em;
      text-transform:uppercase;
      color:rgba(242,242,242,.55);
      white-space:nowrap;
      user-select:none;
    }
    .submitBtn{
      border:1px solid rgba(242,242,242,.20);
      background:rgba(242,242,242,.08);
      color:#fff;
      padding:9px 12px;
      border-radius:10px;
      font-size:12px;
      letter-spacing:.10em;
      text-transform:uppercase;
      cursor:pointer;
      user-select:none;
    }
    .submitBtn:hover{ background:rgba(242,242,242,.12); }
    .submitBtn:disabled{
      opacity:.45;
      cursor:not-allowed;
    }

    .paper{
      width:min(980px,100%);
      margin:0 auto;
      background:var(--paper);
      border:1px solid rgba(0,0,0,.12);
      border-radius:12px;
      overflow:hidden;
      box-shadow:0 24px 70px rgba(0,0,0,.30);
    }
    .paperInner{ padding:22px 22px 28px; }

    .docHeader{
      padding-bottom:18px;
      border-bottom:1px solid rgba(0,0,0,.10);
      margin-bottom:18px;
    }
    .kicker{
      font-size:10px;
      letter-spacing:.18em;
      text-transform:uppercase;
      color:rgba(0,0,0,.45);
      margin-bottom:10px;
    }
    .docTitle{
      margin:0 0 8px;
      font-size:28px;
      line-height:1.1;
      letter-spacing:-0.03em;
      font-weight:700;
      color:var(--txt);
    }
    .docSubtitle{
      margin:0;
      font-size:12px;
      letter-spacing:.04em;
      color:rgba(0,0,0,.52);
      line-height:1.55;
      max-width:80ch;
    }

    .doc{
      color:var(--txt);
      font-size:16px;
      line-height:1.82;
      max-width:82ch;
      font-weight:400;
    }
    .doc p{ margin:0 0 16px; }
    .sectionHead{
      margin:26px 0 10px;
      padding-bottom:8px;
      border-bottom:1px solid rgba(0,0,0,.10);
      font-size:10px;
      letter-spacing:.18em;
      text-transform:uppercase;
      color:rgba(0,0,0,.45);
    }
    .hanging{
      padding-left:1.2em;
      text-indent:-1.2em;
    }

    /* Cross-links between records (non-linear, but not gimmicky) */
    .xref{
      color:rgba(0,0,0,.82);
      text-decoration:none;
      border-bottom:1px solid rgba(0,0,0,.35);
      padding-bottom:1px;
      white-space:nowrap;
    }
    .xref:hover{ border-bottom-color:rgba(0,0,0,.70); }

    /* Sources (simple, no count) */
    .sourceRow{
      margin-top:22px;
      padding-top:14px;
      border-top:1px solid rgba(0,0,0,.10);
      display:flex;
      gap:12px;
      align-items:center;
      flex-wrap:wrap;
    }
    .sourceLabel{
      font-size:11px;
      letter-spacing:.12em;
      text-transform:uppercase;
      color:rgba(0,0,0,.52);
    }
    .sourceLink{
      font-size:12px;
      color:rgba(0,0,0,.85);
      text-decoration:underline;
      text-underline-offset:3px;
    }

    /* ── Redaction system (NOT clickable) ───────────── */
    .redact{
      position:relative;
      display:inline;
      --show:0; /* 0 = hidden, 1 = visible */
    }
    .redactText{
      color:rgba(0,0,0,calc(var(--show) * .90));
      transition:color .25s ease;
      position:relative;
      z-index:1;
    }
    .redact::after{
      content:"";
      position:absolute;
      left:-.05em; right:-.05em;
      top:.14em;
      height:1.08em;
      background:rgba(11,11,11,.92);
      opacity:calc(1 - var(--show));
      transition:opacity .25s ease;
      border-radius:1px;
      pointer-events:none;
    }
    /* weight is just density (still grayscale) */
    .redact[data-w="1"]::after{ background:rgba(11,11,11,.70); }
    .redact[data-w="2"]::after{ background:rgba(11,11,11,.84); }
    .redact[data-w="3"]::after{ background:rgba(11,11,11,.95); }

    /* full-line redaction blocks */
    .blockRedact{
      display:block;
      margin:0 0 16px;
      padding:.30em .36em;
      background:rgba(11,11,11,.92);
      color:transparent;
      border-left:3px solid rgba(0,0,0,.25);
      border-radius:0 2px 2px 0;
      position:relative;
      --show:0;
    }
    .blockRedact span{
      color:rgba(0,0,0,calc(var(--show) * .90));
      transition:color .25s ease;
    }
    .blockRedact::after{
      content:"";
      position:absolute;
      inset:0;
      background:rgba(11,11,11,.92);
      opacity:calc(1 - var(--show));
      transition:opacity .25s ease;
      pointer-events:none;
    }
    .blockRedact[data-w="1"]::after{ background:rgba(11,11,11,.70); }
    .blockRedact[data-w="2"]::after{ background:rgba(11,11,11,.84); }
    .blockRedact[data-w="3"]::after{ background:rgba(11,11,11,.95); }

    /* status text (no colored boxes) */
    .statusLine{
      width:min(980px,100%);
      margin:10px auto 0;
      font-size:11px;
      letter-spacing:.12em;
      text-transform:uppercase;
      color:rgba(242,242,242,.40);
      user-select:none;
      min-height:16px;
    }

    /* ── Responsive ─────────────────────────────────── */
    @media(max-width:900px){
      .landingWrap{ grid-template-columns:1fr; }
      .landingLeft{ min-height:180px; }
      .photo{ min-height:360px; }
      .requestPanel{ justify-content:flex-start; }
    }
    @media(max-width:560px){
      .requestPanel{ flex-wrap:wrap; gap:8px; }
      .input{ width:100%; }
      .select{ width:100%; }
      .checkWrap{ width:100%; justify-content:flex-start; }
      .submitBtn{ width:100%; }
      .docTitle{ font-size:22px; }
    }
  </style>
</head>

<body>
  <div class="stage">
    <div class="topline">
      <div class="title">ACCESS UNDER CONDITIONS</div>
    </div>

    <div class="center">
      <div class="window" id="window" aria-label="Window">
        <div class="chrome">
          <div class="dots" aria-label="Window controls">
            <button class="dotbtn red"    id="btnClose" aria-label="Close (return to landing)"></button>
            <button class="dotbtn yellow" id="btnMin"   aria-label="Minimize"></button>
            <button class="dotbtn green"  id="btnFull"  aria-label="Toggle fullscreen"></button>
          </div>
          <div class="url" id="chromeTitle">ARCHIVE — PUBLIC RECORD</div>
          <div class="chromeRight">
            <button class="iconBtn" id="btnAbout" aria-label="About">i</button>
          </div>
        </div>

        <div class="content" id="content">

          <!-- ══════════ LANDING ══════════ -->
          <section id="landing">
            <div class="landingWrap">
              <div class="landingLeft">
                <div class="landingMark">
                  ARCHIVE INTERFACE<br/>
                
                </div>
                <div class="landingHint">
                  open a file
                </div>
              </div>

              <div class="photo" aria-label="File field">
                <div class="photoTop">
                  <div class="label">file field</div>
                  <div class="hint">click any</div>
                </div>
                <div class="fileField">
                  <div class="files" id="filesGrid" aria-label="Files"></div>
                </div>
                <div class="photoBottom">
                  <span>3 records — public text</span>
                  <span>about: top-right</span>
                </div>
              </div>
            </div>
          </section>

          <!-- ══════════ ABOUT ══════════ -->
          <section id="about">
            <div class="aboutWrap">
              <div class="topBar" style="margin-bottom:0;">
                <a class="navBtn" href="#landing">← Back</a>
              </div>

              <div class="aboutCard">
                <h3 class="aboutTitle">About</h3>
                <p class="aboutText">
                  
                  You submit a request, accept conditions, choose a format, and wait.
                  The interface mirrors how institutions turn rights into procedures.
                </p>

                <div class="aboutRule">
                 
                </div>

                <div class="aboutLinks">
                  <a class="aboutLink" href="#record" id="aboutOpenRecord">open last record</a>
                  <a class="aboutLink" href="#landing">back to files</a>
                </div>
              </div>
            </div>
          </section>

          <!-- ══════════ RECORD ══════════ -->
          <section id="record">
            <div class="recordWrap">
              <div class="topBar">
                <a class="navBtn" href="#landing">← Back</a>

                <div class="requestPanel" aria-label="Request controls">
                  <span class="miniLabel">format</span>
                  <select class="select" id="formatSel" aria-label="Format">
                    <option value="screen">screen view</option>
                    <option value="pdf">pdf copy</option>
                    <option value="csv">csv export</option>
                  </select>

                  <label class="checkWrap" aria-label="Acknowledge delays and fees">
                    <input type="checkbox" id="ackBox" />
                    <span>check here</span>
                  </label>

                  <input class="input" id="phraseInput" type="text" inputmode="text" autocomplete="off"
                    placeholder='type: REQUEST ACCESS' aria-label="Type request phrase" />

                  <button class="submitBtn" id="submitBtn" type="button">submit</button>
                </div>
              </div>

              <div class="statusLine" id="statusLine"></div>

              <div class="paper" id="paper">
                <div class="paperInner">
                  <div class="docHeader">
                    <div class="kicker" id="docKicker">Record · excerpt</div>
                    <h2 class="docTitle" id="docTitle">—</h2>
                    <p class="docSubtitle" id="docSubtitle"></p>
                  </div>

                  <article class="doc" id="docBody">
                    <p>Select a file on the landing page.</p>
                  </article>

                  <div class="sourceRow" id="sourceRow" style="display:none">
                    <div class="sourceLabel">Primary source</div>
                    <a class="sourceLink" id="sourceLink" href="#" target="_blank" rel="noopener noreferrer">—</a>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div><!-- /content -->
      </div><!-- /window -->
    </div>
  </div>

<script>
(function(){
  /* ── DOM ──────────────────────────────────────────── */
  const win        = document.getElementById('window');
  const chromeTitle= document.getElementById('chromeTitle');

  const btnClose   = document.getElementById('btnClose');
  const btnMin     = document.getElementById('btnMin');
  const btnFull    = document.getElementById('btnFull');
  const btnAbout   = document.getElementById('btnAbout');
  const aboutOpenRecord = document.getElementById('aboutOpenRecord');

  const filesGrid  = document.getElementById('filesGrid');

  const docKicker  = document.getElementById('docKicker');
  const docTitle   = document.getElementById('docTitle');
  const docSubtitle= document.getElementById('docSubtitle');
  const docBody    = document.getElementById('docBody');

  const sourceRow  = document.getElementById('sourceRow');
  const sourceLink = document.getElementById('sourceLink');

  const formatSel  = document.getElementById('formatSel');
  const ackBox     = document.getElementById('ackBox');
  const phraseInput= document.getElementById('phraseInput');
  const submitBtn  = document.getElementById('submitBtn');
  const statusLine = document.getElementById('statusLine');

  /* ── State ────────────────────────────────────────── */
  let currentIdx = 0;
  let granted = false;
  let processing = false;

  const REQUEST_PHRASE = "REQUEST ACCESS";

  /* ── Mac controls ─────────────────────────────────── */
  function goLanding(){
    location.hash = '#landing';
    win.classList.remove('is-minimized','is-fullscreen');
    chromeTitle.textContent = 'ARCHIVE — PUBLIC RECORD';
    statusLine.textContent = '';
  }

  btnClose.addEventListener('click', goLanding);

  btnMin.addEventListener('click', () => {
    win.classList.toggle('is-minimized');
  });

  btnFull.addEventListener('click', () => {
    win.classList.toggle('is-fullscreen');
    win.classList.remove('is-minimized');
  });

  btnAbout.addEventListener('click', () => {
    location.hash = '#about';
    chromeTitle.textContent = 'ABOUT';
  });

  aboutOpenRecord.addEventListener('click', () => {
    location.hash = '#record';
    chromeTitle.textContent = 'RECORD';
  });

  window.addEventListener('keydown', e => {
    if(e.key === 'Escape'){
      if(win.classList.contains('is-fullscreen')) win.classList.remove('is-fullscreen');
      else if(location.hash === '#record' || location.hash === '#about') goLanding();
    }
  });

  /* ── Landing file positions (UNCHANGED) ───────────── */
  const FILE_POSITIONS = [
    {col:3,row:2,tx:-5.6,ty:-3.5,rot:-3},{col:10,row:7,tx:-3.5,ty:2.1,rot:1},
    {col:7,row:12,tx:-1.4,ty:0,rot:-2},{col:4,row:3,tx:.7,ty:2.8,rot:2},
    {col:1,row:8,tx:2.8,ty:-.7,rot:-1},{col:8,row:13,tx:4.9,ty:2.1,rot:3},
    {col:5,row:4,tx:-4.9,ty:0,rot:0},{col:2,row:9,tx:-2.8,ty:2.8,rot:-3},
    {col:9,row:14,tx:-.7,ty:-.7,rot:1},{col:6,row:5,tx:1.4,ty:2.1,rot:-2},
    {col:3,row:10,tx:3.5,ty:0,rot:2},{col:10,row:1,tx:5.6,ty:2.8,rot:-1},
    {col:7,row:6,tx:-4.2,ty:-.7,rot:3},{col:4,row:11,tx:-2.1,ty:2.1,rot:0},
    {col:1,row:2,tx:0,ty:0,rot:-3},{col:8,row:7,tx:2.1,ty:2.8,rot:1},
    {col:5,row:12,tx:4.2,ty:-.7,rot:-2},{col:2,row:3,tx:-5.6,ty:2.1,rot:2},
    {col:9,row:8,tx:-3.5,ty:0,rot:-1},{col:6,row:13,tx:-1.4,ty:2.8,rot:3},
    {col:3,row:4,tx:.7,ty:-.7,rot:0},{col:10,row:9,tx:2.8,ty:2.1,rot:-3},
    {col:7,row:14,tx:4.9,ty:0,rot:1},{col:4,row:5,tx:-4.9,ty:2.8,rot:-2},
    {col:1,row:10,tx:-2.8,ty:-.7,rot:2},{col:8,row:1,tx:-.7,ty:2.1,rot:-1},
    {col:5,row:6,tx:1.4,ty:0,rot:3},{col:2,row:11,tx:3.5,ty:2.8,rot:0},
    {col:9,row:2,tx:5.6,ty:-.7,rot:-3},{col:6,row:7,tx:-4.2,ty:2.1,rot:1},
    {col:3,row:12,tx:-2.1,ty:0,rot:-2},{col:10,row:3,tx:0,ty:2.8,rot:2},
    {col:7,row:8,tx:2.1,ty:-.7,rot:-1},{col:4,row:13,tx:4.2,ty:2.1,rot:3},
    {col:1,row:4,tx:-5.6,ty:0,rot:0},{col:8,row:9,tx:-3.5,ty:2.8,rot:-3},
    {col:5,row:14,tx:-1.4,ty:-.7,rot:1},{col:2,row:5,tx:.7,ty:2.1,rot:-2},
    {col:9,row:10,tx:2.8,ty:0,rot:2},{col:6,row:1,tx:4.9,ty:2.8,rot:-1},
    {col:3,row:6,tx:-4.9,ty:-.7,rot:3},{col:10,row:11,tx:-2.8,ty:2.1,rot:0},
    {col:7,row:2,tx:-.7,ty:0,rot:-3},{col:4,row:7,tx:1.4,ty:2.8,rot:1},
    {col:1,row:12,tx:3.5,ty:-.7,rot:-2},{col:8,row:3,tx:5.6,ty:2.1,rot:2},
    {col:5,row:8,tx:-4.2,ty:0,rot:-1},{col:2,row:13,tx:-2.1,ty:2.8,rot:3},
    {col:9,row:4,tx:0,ty:-.7,rot:0},{col:6,row:9,tx:2.1,ty:2.1,rot:-3},
    {col:3,row:14,tx:4.2,ty:0,rot:1},{col:10,row:5,tx:-5.6,ty:2.8,rot:-2},
    {col:7,row:10,tx:-3.5,ty:-.7,rot:2},{col:4,row:1,tx:-1.4,ty:2.1,rot:-1},
    {col:1,row:6,tx:.7,ty:0,rot:3},{col:8,row:11,tx:2.8,ty:2.8,rot:0},
    {col:5,row:2,tx:4.9,ty:-.7,rot:-3},{col:2,row:7,tx:-4.9,ty:2.1,rot:1},
    {col:9,row:12,tx:-2.8,ty:0,rot:-2},{col:6,row:3,tx:-.7,ty:2.8,rot:2},
    {col:3,row:8,tx:1.4,ty:-.7,rot:-1},{col:10,row:13,tx:3.5,ty:2.1,rot:3},
    {col:7,row:4,tx:5.6,ty:0,rot:0},{col:4,row:9,tx:-4.2,ty:2.8,rot:-3},
    {col:1,row:14,tx:-2.1,ty:-.7,rot:1},{col:8,row:5,tx:0,ty:2.1,rot:-2},
    {col:5,row:10,tx:2.1,ty:0,rot:2},{col:2,row:1,tx:4.2,ty:2.8,rot:-1},
  ];

  function buildFiles(){
    filesGrid.innerHTML = '';
    FILE_POSITIONS.forEach((p, i) => {
      const a = document.createElement('a');
      a.className = 'file';
      a.href = '#record';
      a.setAttribute('aria-label', 'Open file ' + (i+1));
      a.style.cssText =
        `grid-column:${p.col};grid-row:${p.row};transform:translate(${p.tx}px,${p.ty}px) rotate(${p.rot}deg)`;
      filesGrid.appendChild(a);
    });
    restoreVisited();
  }

  /* visited dim */
  function markVisited(i){
    try{
      const key = 'visitedFiles_v1';
      const arr = JSON.parse(localStorage.getItem(key)||'[]');
      if(!arr.includes(i)) arr.push(i);
      localStorage.setItem(key, JSON.stringify(arr));
      const a = filesGrid.children[i];
      if(a){
        a.style.opacity='0.55';
        a.style.filter='grayscale(1) drop-shadow(0 10px 18px rgba(0,0,0,.32))';
      }
    }catch(_){}
  }

  function restoreVisited(){
    try{
      const arr = JSON.parse(localStorage.getItem('visitedFiles_v1')||'[]');
      arr.forEach(i => {
        const a = filesGrid.children[i];
        if(a){
          a.style.opacity='0.55';
          a.style.filter='grayscale(1) drop-shadow(0 10px 18px rgba(0,0,0,.32))';
        }
      });
    }catch(_){}
  }

 
  function esc(s){
    return String(s)
      .replace(/&/g,'&amp;')
      .replace(/</g,'&lt;')
      .replace(/>/g,'&gt;')
      .replace(/"/g,'&quot;');
  }

  function R(text, w){
    return `<span class="redact" data-w="${w}"><span class="redactText">${esc(text)}</span></span>`;
  }

  function BR(text, w){
    return `<span class="blockRedact" data-w="${w}"><span>${esc(text)}</span></span>`;
  }

  function applyGrant(){
    const fmt = formatSel.value;

   
    let allowW = 1;
    if(fmt === 'pdf') allowW = 2;
    if(fmt === 'csv') allowW = 1;

    docBody.querySelectorAll('.redact').forEach(n => {
      const w = +n.dataset.w;
      const show = granted && (w <= allowW);
      n.style.setProperty('--show', show ? 1 : 0);
    });

    docBody.querySelectorAll('.blockRedact').forEach(n => {
      const w = +n.dataset.w;
      const show = granted && (w <= allowW);
      n.style.setProperty('--show', show ? 1 : 0);
    });
  }

  
  const records = [
    {
      kicker:'Record A · EU Regulation 2016/679',
      title:'Right of Access by the Data Subject',
      subtitle:'GDPR, Article 15 — Official Journal of the European Union, 4 May 2016',
      sourceText:'EUR-Lex — Regulation (EU) 2016/679, Article 15',
      sourceUrl:'https://eur-lex.europa.eu/legal-content/EN/TXT/?uri=CELEX%3A32016R0679',
      body: () => `
        <div class="sectionHead">Article 15(1)</div>

        <p>The data subject shall have the right to obtain from the controller ${R('confirmation as to whether or not personal data concerning him or her are being processed',1)}, and, where that is the case, access to the personal data and the following information:</p>

        <p class="hanging">(a) the ${R('purposes of the processing',1)};</p>
        <p class="hanging">(b) the ${R('categories of personal data concerned',1)};</p>
        <p class="hanging">(c) the ${R('recipients or categories of recipient',2)} to whom the personal data have been or will be disclosed, in particular recipients in third countries or ${R('international organisations',2)};</p>
        <p class="hanging">(d) where possible, the ${R('envisaged period for which the personal data will be stored',2)}, or, if not possible, the ${R('criteria used to determine that period',3)};</p>

        <div class="sectionHead">Article 15(3)–(4)</div>

        <p>The controller shall provide a copy of the personal data undergoing processing. For any further copies requested by the data subject, the controller may charge a ${R('reasonable fee based on administrative costs',2)}.</p>

        <p>${BR('Where the data subject makes the request by electronic means, and unless otherwise requested by the data subject, the information shall be provided in a commonly used electronic form.',2)}</p>

        <p>The right to obtain a copy referred to in paragraph 3 shall not ${R('adversely affect the rights and freedoms of others',3)}.</p>

        <p style="margin-top:18px;">
          <a class="xref" href="#record" data-jump="1">Jump: FOIA exemptions</a>
          &nbsp;·&nbsp;
          <a class="xref" href="#record" data-jump="2">Jump: CPRA “trade secrets”</a>
        </p>
      `
    },

    {
      kicker:'Record B · United States Code',
      title:'Freedom of Information Act',
      subtitle:'5 U.S.C. § 552 — Administrative Procedure Act, as amended',
      sourceText:'GovInfo — 5 U.S.C. § 552',
      sourceUrl:'https://www.govinfo.gov/content/pkg/USCODE-2018-title5/pdf/USCODE-2018-title5-partI-chap5-subchapII-sec552.pdf',
      body: () => `
        <div class="sectionHead">§ 552(a)(3)(A)</div>

        <p>Except with respect to the records made available under paragraphs (1) and (2) of this subsection, ${R('each agency, upon any request for records which (i) reasonably describes such records and (ii) is made in accordance with published rules stating the time, place, fees (if any), and procedures to be followed, shall make the records promptly available to any person',1)}.</p>

        <p>In making any record available to a person under this paragraph, an agency shall provide the record in any form or format requested by the person if the record is ${R('readily reproducible by the agency in that form or format',2)}.</p>

        <div class="sectionHead">§ 552(b) (selected)</div>

        <p class="hanging">(1) ${R('specifically authorized under criteria established by an Executive order to be kept secret in the interest of national defense or foreign policy',2)};</p>
        <p class="hanging">(3) specifically exempted from disclosure by statute ${R('(other than section 552b of this title)',3)} … that statute … ${R('establishes particular criteria for withholding or refers to particular types of matters to be withheld',3)};</p>
        <p class="hanging">(5) ${R('inter-agency or intra-agency memorandums or letters that would not be available by law to a party other than an agency in litigation with the agency',3)};</p>
        <p class="hanging">(6) … disclosure of which would constitute a ${R('clearly unwarranted invasion of personal privacy',2)};</p>

        <p>${BR('(8) contained in or related to examination, operating, or condition reports prepared by, on behalf of, or for the use of an agency responsible for the regulation or supervision of financial institutions; or (9) geological and geophysical information and data, including maps, concerning wells.',3)}</p>

        <p style="margin-top:18px;">
          <a class="xref" href="#record" data-jump="0">Jump: GDPR “rights of others”</a>
          &nbsp;·&nbsp;
          <a class="xref" href="#record" data-jump="2">Jump: CPRA “trade secrets”</a>
        </p>
      `
    },

    {
      kicker:'Record C · California Civil Code',
      title:'Consumer Right to Know and Access',
      subtitle:'Cal. Civ. Code §§ 1798.100, 1798.110 — California Privacy Rights Act (effective Jan. 1, 2023)',
      sourceText:'California Legislative Information — § 1798.100',
      sourceUrl:'https://leginfo.legislature.ca.gov/faces/codes_displaySection.xhtml?lawCode=CIV&sectionNum=1798.100.',
      body: () => `
        <div class="sectionHead">§ 1798.100</div>

        <p>A consumer shall have the right to request that a business that ${R("collects a consumer's personal information",1)} disclose to that consumer the categories and specific pieces of personal information the business has collected.</p>

        <p class="hanging">(1) The ${R('categories of personal information to be collected',1)} … and whether that information is ${R('sold or shared',2)}.</p>
        <p class="hanging">(2) If the business collects ${R('sensitive personal information',2)} … whether that information is sold or shared.</p>
        <p class="hanging">(3) The ${R('length of time the business intends to retain each category of personal information',2)}, or … the ${R('criteria used to determine such period',3)}.</p>

        <div class="sectionHead">§ 1798.185 (selected)</div>

        <p>… adopt regulations … including, but not limited to, those relating to ${R('trade secrets and intellectual property rights',2)} …</p>

        <p>${BR('(C) For the development and use of a recognizable and uniform opt-out logo or button by all businesses to promote consumer awareness of the opportunity to opt out of the sale of personal information.',2)}</p>

        <p style="margin-top:18px;">
          <a class="xref" href="#record" data-jump="0">Jump: GDPR access list</a>
          &nbsp;·&nbsp;
          <a class="xref" href="#record" data-jump="1">Jump: FOIA format clause</a>
        </p>
      `
    }
  ];

  /* ── Load record ──────────────────────────────────── */
  function resetRequestUI(){
    granted = false;
    processing = false;
    ackBox.checked = false;
    phraseInput.value = '';
    formatSel.value = 'screen';
    submitBtn.disabled = false;
    statusLine.textContent = '';
  }

  function loadRecord(idx){
    currentIdx = (idx + records.length) % records.length;
    const r = records[currentIdx];

    resetRequestUI();

    docKicker.textContent = r.kicker;
    docTitle.textContent = r.title;
    docSubtitle.textContent = r.subtitle;

    docBody.innerHTML = r.body();

    sourceLink.textContent = r.sourceText;
    sourceLink.href = r.sourceUrl;
    sourceRow.style.display = '';

    chromeTitle.textContent = 'RECORD';

    // start fully redacted (until request is granted)
    applyGrant();
  }

  /* ── Request ritual (Option 7) ────────────────────── */
  function normalized(s){ return String(s || '').trim().toUpperCase().replace(/\s+/g,' '); }

  function canSubmit(){
    return ackBox.checked && normalized(phraseInput.value) === REQUEST_PHRASE && !processing;
  }

  function setSubmitState(){
    submitBtn.disabled = !canSubmit();
  }

  ackBox.addEventListener('change', setSubmitState);
  phraseInput.addEventListener('input', setSubmitState);

  submitBtn.addEventListener('click', () => {
    if(!canSubmit()) return;

    processing = true;
    submitBtn.disabled = true;
    statusLine.textContent = 'request received · processing';
    // tiny forced delay = bureaucracy (no animation gimmicks)
    setTimeout(() => {
      granted = true;
      processing = false;
      statusLine.textContent = 'partial release issued · scope depends on format';
      applyGrant();
      setSubmitState();
    }, 1400);
  });

  formatSel.addEventListener('change', () => {
    // format is a condition: change it, the release changes
    applyGrant();
  });

  /* ── Cross-link jumps between records ─────────────── */
  document.addEventListener('click', (e) => {
    const x = e.target.closest('.xref');
    if(!x) return;
    const jump = x.getAttribute('data-jump');
    if(jump == null) return;
    e.preventDefault();
    const n = parseInt(jump, 10);
    if(Number.isFinite(n)){
      sessionStorage.setItem('auc_case', String(n));
      loadRecord(n);
      location.hash = '#record';
    }
  });

  /* ── Build file grid ─────────────────────────────── */
  buildFiles();

  filesGrid.addEventListener('click', e => {
    const a = e.target.closest('a.file');
    if(!a) return;
    const idx = [...filesGrid.children].indexOf(a);
    sessionStorage.setItem('auc_case', String(idx % records.length));
    markVisited(idx);
    loadRecord(idx % records.length);
    chromeTitle.textContent = 'RECORD';
  });

  /* ── Boot ─────────────────────────────────────────── */
  function boot(){
    const saved = sessionStorage.getItem('auc_case');
    loadRecord(saved ? +saved : 0);
  }
  boot();

  window.addEventListener('hashchange', () => {
    if(location.hash === '#record'){
      const saved = sessionStorage.getItem('auc_case');
      loadRecord(saved ? +saved : currentIdx);
      win.classList.remove('is-minimized');
    } else if(location.hash === '#about'){
      chromeTitle.textContent = 'ABOUT';
    } else {
      chromeTitle.textContent = 'ARCHIVE — PUBLIC RECORD';
    }
  });

})();
</script>
</body>
</html>
</html>

